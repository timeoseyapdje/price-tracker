<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PrixTrack â€” Trains & Tech</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0a0c0f;
    --bg2: #0f1318;
    --bg3: #141920;
    --bg4: #1a2230;
    --border: #1e2d3d;
    --border2: #253545;
    --text: #c8d8e8;
    --text2: #7a9ab5;
    --text3: #4a6a85;
    --green: #00d4a4;
    --green2: #00f5c0;
    --red: #ff4b6e;
    --red2: #ff6b8a;
    --blue: #4d9fff;
    --blue2: #7dbfff;
    --yellow: #ffd166;
    --accent: #00d4a4;
    --glow-green: 0 0 20px rgba(0, 212, 164, 0.3);
    --glow-red: 0 0 20px rgba(255, 75, 110, 0.3);
    --glow-blue: 0 0 20px rgba(77, 159, 255, 0.3);
    --card-shadow: 0 4px 24px rgba(0,0,0,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Space Grotesk', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Scanline effect */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.03) 2px,
      rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 1000;
  }

  /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    padding: 0 20px;
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 56px;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.5px;
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--green), var(--blue));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .logo span { color: var(--green); }

  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .live-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 500;
    color: var(--green);
    background: rgba(0,212,164,0.1);
    border: 1px solid rgba(0,212,164,0.3);
    padding: 4px 10px;
    border-radius: 20px;
  }

  .live-dot {
    width: 6px;
    height: 6px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.8); }
  }

  .clock {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text3);
  }

  /* â”€â”€â”€ Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tab-bar {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    display: flex;
    padding: 0 20px;
    gap: 0;
  }

  .tab-btn {
    padding: 14px 20px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 13px;
    font-weight: 500;
    color: var(--text3);
    cursor: pointer;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }

  .tab-btn:hover { color: var(--text); }
  .tab-btn.active {
    color: var(--text);
    border-bottom-color: var(--green);
  }

  .tab-btn .tab-icon { font-size: 15px; }

  /* â”€â”€â”€ Main Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  .section { display: none; }
  .section.active { display: block; }

  /* â”€â”€â”€ Train Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .search-bar {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: flex-end;
  }

  .field-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex: 1;
    min-width: 150px;
  }

  .field-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text3);
  }

  .select-input, .date-input {
    background: var(--bg3);
    border: 1px solid var(--border2);
    border-radius: 8px;
    color: var(--text);
    padding: 10px 14px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
    appearance: none;
    cursor: pointer;
    width: 100%;
  }

  .select-input:focus, .date-input:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 2px rgba(0,212,164,0.15);
  }

  .search-btn {
    background: linear-gradient(135deg, var(--green), #00b890);
    color: #0a0c0f;
    border: none;
    border-radius: 8px;
    padding: 10px 24px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    align-self: flex-end;
    height: 42px;
  }

  .search-btn:hover {
    transform: translateY(-1px);
    box-shadow: var(--glow-green);
  }

  .search-btn:active { transform: translateY(0); }

  /* â”€â”€â”€ Ticker Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .ticker-container {
    overflow: hidden;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 0;
    margin-bottom: 20px;
    position: relative;
  }

  .ticker-container::before,
  .ticker-container::after {
    content: '';
    position: absolute;
    top: 0; bottom: 0;
    width: 60px;
    z-index: 2;
    pointer-events: none;
  }

  .ticker-container::before {
    left: 0;
    background: linear-gradient(to right, var(--bg2), transparent);
  }

  .ticker-container::after {
    right: 0;
    background: linear-gradient(to left, var(--bg2), transparent);
  }

  .ticker-track {
    display: flex;
    gap: 32px;
    animation: ticker 30s linear infinite;
    white-space: nowrap;
    padding: 0 20px;
  }

  @keyframes ticker {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  .ticker-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
  }

  .ticker-route { color: var(--text2); font-weight: 500; }
  .ticker-price { color: var(--text); font-weight: 700; }
  .ticker-change { font-size: 11px; font-weight: 500; }
  .ticker-change.up { color: var(--green); }
  .ticker-change.down { color: var(--red); }

  /* â”€â”€â”€ Main Chart Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chart-area {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 20px;
    margin-bottom: 20px;
  }

  @media (max-width: 900px) {
    .chart-area { grid-template-columns: 1fr; }
  }

  .chart-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .chart-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
  }

  .chart-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
  }

  .chart-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
    margin-top: 2px;
  }

  .price-display {
    text-align: right;
  }

  .current-price {
    font-family: 'JetBrains Mono', monospace;
    font-size: 28px;
    font-weight: 700;
    line-height: 1;
  }

  .price-change {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 500;
    margin-top: 4px;
  }

  .up { color: var(--green); }
  .down { color: var(--red); }

  .chart-body {
    padding: 16px;
    height: 320px;
    position: relative;
  }

  .chart-body canvas { width: 100% !important; }

  .chart-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--text3);
    gap: 12px;
    font-size: 14px;
  }

  .chart-empty .empty-icon { font-size: 48px; opacity: 0.3; }

  /* â”€â”€â”€ Stats Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-panel {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  .stat-row {
    background: var(--bg3);
    padding: 14px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 0;
    transition: background 0.15s;
  }

  .stat-row:first-child { border-radius: 8px 8px 0 0; }
  .stat-row:last-child { border-radius: 0 0 8px 8px; }
  .stat-row:hover { background: var(--bg4); }

  .stat-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
  }

  /* â”€â”€â”€ Route Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }

  .route-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 12px;
  }

  .route-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .route-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    background: var(--border2);
    transition: background 0.2s;
  }

  .route-card:hover {
    border-color: var(--border2);
    transform: translateY(-2px);
    box-shadow: var(--card-shadow);
  }

  .route-card:hover::before { background: var(--green); }
  .route-card.active-card { border-color: rgba(0,212,164,0.4); }
  .route-card.active-card::before { background: var(--green); }

  .route-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .route-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .route-arrow { color: var(--text3); font-size: 12px; }

  .route-price {
    font-family: 'JetBrains Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
  }

  .route-sparkline {
    height: 36px;
    margin-top: 8px;
  }

  .route-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
  }

  .route-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    padding: 2px 7px;
    border-radius: 4px;
    font-weight: 600;
  }

  .route-badge.up {
    background: rgba(0,212,164,0.15);
    color: var(--green);
    border: 1px solid rgba(0,212,164,0.3);
  }

  .route-badge.down {
    background: rgba(255,75,110,0.15);
    color: var(--red);
    border: 1px solid rgba(255,75,110,0.3);
  }

  .route-vol {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text3);
  }

  /* â”€â”€â”€ Tech Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tech-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  @media (max-width: 768px) {
    .tech-layout { grid-template-columns: 1fr; }
  }

  .tech-category {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .tech-category-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--bg3);
  }

  .tech-category-icon {
    width: 30px;
    height: 30px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .tech-category-icon.gpu { background: rgba(77,159,255,0.2); }
  .tech-category-icon.ram { background: rgba(255,209,102,0.2); }

  .tech-category-name {
    font-size: 14px;
    font-weight: 600;
  }

  .tech-table {
    width: 100%;
    border-collapse: collapse;
  }

  .tech-table thead tr {
    border-bottom: 1px solid var(--border);
  }

  .tech-table th {
    padding: 10px 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: left;
    background: var(--bg3);
  }

  .tech-table th:last-child,
  .tech-table td:last-child {
    text-align: right;
    padding-right: 16px;
  }

  .tech-table td {
    padding: 12px 16px;
    font-size: 13px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.15s;
  }

  .tech-table tr:last-child td { border-bottom: none; }
  .tech-table tr:hover td { background: var(--bg3); }

  .td-name {
    font-weight: 500;
    color: var(--text);
    font-size: 13px;
  }

  .td-price {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    color: var(--text);
    font-size: 14px;
  }

  .td-change {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 600;
  }

  .td-sparkline { width: 80px; }

  /* â”€â”€â”€ Tech Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tech-chart-section {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 20px;
  }

  /* â”€â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    color: var(--text3);
    gap: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--border2);
    border-top-color: var(--green);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€â”€ Flash animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @keyframes flash-green {
    0%, 100% { background: transparent; }
    50% { background: rgba(0,212,164,0.08); }
  }

  @keyframes flash-red {
    0%, 100% { background: transparent; }
    50% { background: rgba(255,75,110,0.08); }
  }

  .flash-up { animation: flash-green 0.5s ease; }
  .flash-down { animation: flash-red 0.5s ease; }

  /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 600px) {
    header { padding: 0 12px; }
    .logo { font-size: 15px; }
    main { padding: 12px; }
    .search-bar { padding: 14px; gap: 10px; }
    .field-group { min-width: 120px; }
    .current-price { font-size: 22px; }
    .chart-body { height: 240px; }
    .route-grid { grid-template-columns: 1fr; }
    .tab-btn { padding: 12px 12px; font-size: 12px; }
    .tab-btn span:not(.tab-icon) { display: none; }
    .tab-btn .tab-icon { font-size: 18px; }
    .tech-table .td-sparkline { display: none; }
    .clock { display: none; }
  }

  /* â”€â”€â”€ Tooltip Override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chartjs-tooltip {
    background: var(--bg3) !important;
    border: 1px solid var(--border2) !important;
    border-radius: 8px !important;
    font-family: 'JetBrains Mono', monospace !important;
    font-size: 12px !important;
    padding: 8px 12px !important;
    color: var(--text) !important;
  }

  /* â”€â”€â”€ Watchlist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .watchlist-section {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 20px;
  }

  .watchlist-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .wl-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .wl-items {
    display: flex;
    overflow-x: auto;
    gap: 0;
    scrollbar-width: none;
  }

  .wl-items::-webkit-scrollbar { display: none; }

  .wl-item {
    flex-shrink: 0;
    padding: 12px 20px;
    border-right: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.15s;
    min-width: 140px;
  }

  .wl-item:hover { background: var(--bg3); }
  .wl-item:last-child { border-right: none; }

  .wl-item-route {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
    margin-bottom: 4px;
    text-transform: uppercase;
  }

  .wl-item-price {
    font-family: 'JetBrains Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
  }

  .wl-item-change {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    margin-top: 2px;
  }

  /* â”€â”€â”€ Sidebar panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sidebar-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .sidebar-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--bg3);
  }

  .order-book-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    padding: 7px 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    border-bottom: 1px solid rgba(30,45,61,0.5);
    transition: background 0.15s;
  }

  .order-book-row:hover { background: var(--bg3); }
  .order-book-row .ask { color: var(--red); }
  .order-book-row .bid { color: var(--green); text-align: right; }
  .order-book-row .mid { color: var(--text3); text-align: center; font-size: 10px; }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">ğŸ“ˆ</div>
    Prix<span>Track</span>
  </div>
  <div class="header-right">
    <div class="live-badge">
      <div class="live-dot"></div>
      <span>EN DIRECT</span>
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </div>
</header>

<div class="tab-bar">
  <button class="tab-btn active" onclick="switchTab('trains')" id="tab-trains">
    <span class="tab-icon">ğŸš„</span>
    <span>Trains France</span>
  </button>
  <button class="tab-btn" onclick="switchTab('tech')" id="tab-tech">
    <span class="tab-icon">ğŸ’»</span>
    <span>Tech & GPU / RAM</span>
  </button>
</div>

<main>

  <!-- â•â•â•â•â•â•â•â•â•â• TRAINS SECTION â•â•â•â•â•â•â•â•â•â• -->
  <div class="section active" id="section-trains">

    <!-- Search Bar -->
    <div class="search-bar">
      <div class="field-group">
        <div class="field-label">DÃ©part</div>
        <select class="select-input" id="select-from" onchange="updateToOptions()">
          <option value="">Choisir...</option>
        </select>
      </div>
      <div class="field-group">
        <div class="field-label">ArrivÃ©e</div>
        <select class="select-input" id="select-to">
          <option value="">Choisir...</option>
        </select>
      </div>
      <div class="field-group" style="max-width: 180px;">
        <div class="field-label">Date voyage</div>
        <input type="date" class="date-input" id="travel-date">
      </div>
      <button class="search-btn" onclick="searchTrain()">ğŸ“Š Tracker</button>
    </div>

    <!-- Ticker -->
    <div class="ticker-container" id="ticker-container">
      <div class="ticker-track" id="ticker-track">
        <span class="ticker-item"><span class="ticker-route">Chargement...</span></span>
      </div>
    </div>

    <!-- Watchlist -->
    <div class="watchlist-section">
      <div class="watchlist-header">
        <div class="wl-title">â­ Routes suivies</div>
      </div>
      <div class="wl-items" id="watchlist-items">
        <div class="loading"><div class="spinner"></div> Chargement...</div>
      </div>
    </div>

    <!-- Main Chart -->
    <div class="chart-area">
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title" id="main-chart-title">SÃ©lectionnez une route</div>
            <div class="chart-subtitle" id="main-chart-subtitle">Ã‰volution du prix en temps rÃ©el</div>
          </div>
          <div class="price-display" id="main-price-display" style="display:none;">
            <div class="current-price" id="main-current-price">â€”</div>
            <div class="price-change" id="main-price-change"></div>
          </div>
        </div>
        <div class="chart-body">
          <canvas id="mainChart" style="display:none;"></canvas>
          <div class="chart-empty" id="chart-empty">
            <div class="empty-icon">ğŸš„</div>
            <span>SÃ©lectionnez une route ou cliquez sur une carte</span>
          </div>
        </div>
      </div>

      <!-- Stats Panel -->
      <div class="sidebar-card">
        <div class="sidebar-header">Statistiques</div>
        <div class="stats-panel" id="stats-panel">
          <div class="stat-row">
            <span class="stat-label">Ouverture</span>
            <span class="stat-value" id="stat-open">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Plus haut</span>
            <span class="stat-value" id="stat-high" style="color: var(--green)">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Plus bas</span>
            <span class="stat-value" id="stat-low" style="color: var(--red)">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Actuel</span>
            <span class="stat-value" id="stat-current">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Variation</span>
            <span class="stat-value" id="stat-change">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Var. %</span>
            <span class="stat-value" id="stat-changepct">â€”</span>
          </div>
        </div>

        <div class="sidebar-header" style="margin-top:1px;">Carnet d'ordres simulÃ©</div>
        <div id="order-book">
          <div style="padding:10px 16px; font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--text3); text-align:center;">
            SÃ©lectionnez une route
          </div>
        </div>
      </div>
    </div>

    <!-- All Routes Grid -->
    <div class="section-title">Toutes les routes</div>
    <div class="route-grid" id="route-grid">
      <div class="loading"><div class="spinner"></div> Chargement des routes...</div>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• TECH SECTION â•â•â•â•â•â•â•â•â•â• -->
  <div class="section" id="section-tech">

    <!-- Tech Main Chart -->
    <div class="tech-chart-section">
      <div class="chart-header">
        <div>
          <div class="chart-title" id="tech-chart-title">SÃ©lectionnez un composant</div>
          <div class="chart-subtitle" id="tech-chart-subtitle">Ã‰volution du prix en temps rÃ©el</div>
        </div>
        <div class="price-display" id="tech-price-display" style="display:none;">
          <div class="current-price" id="tech-current-price">â€”</div>
          <div class="price-change" id="tech-price-change"></div>
        </div>
      </div>
      <div class="chart-body">
        <canvas id="techChart" style="display:none;"></canvas>
        <div class="chart-empty" id="tech-chart-empty">
          <div class="empty-icon">ğŸ–¥ï¸</div>
          <span>Cliquez sur un composant pour voir son Ã©volution</span>
        </div>
      </div>
    </div>

    <!-- Tech Tables -->
    <div class="tech-layout">
      <!-- GPU Table -->
      <div class="tech-category">
        <div class="tech-category-header">
          <div class="tech-category-icon gpu">ğŸ®</div>
          <div>
            <div class="tech-category-name">Cartes Graphiques</div>
          </div>
        </div>
        <table class="tech-table">
          <thead>
            <tr>
              <th>ModÃ¨le</th>
              <th>Prix</th>
              <th>Var.</th>
              <th class="td-sparkline">7j</th>
            </tr>
          </thead>
          <tbody id="gpu-tbody">
            <tr><td colspan="4" class="loading"><div class="spinner"></div></td></tr>
          </tbody>
        </table>
      </div>

      <!-- RAM Table -->
      <div class="tech-category">
        <div class="tech-category-header">
          <div class="tech-category-icon ram">ğŸ’¾</div>
          <div>
            <div class="tech-category-name">MÃ©moire RAM</div>
          </div>
        </div>
        <table class="tech-table">
          <thead>
            <tr>
              <th>ModÃ¨le</th>
              <th>Prix</th>
              <th>Var.</th>
              <th class="td-sparkline">7j</th>
            </tr>
          </thead>
          <tbody id="ram-tbody">
            <tr><td colspan="4" class="loading"><div class="spinner"></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>

</main>

<script>
// â”€â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API = '';  // same origin
let mainChart = null;
let techChart = null;
let selectedRoute = null;
let selectedTech = null;
let allRoutes = [];
let techData = {};
let sparklineCharts = {};
let updateInterval = null;

const GPU_MODELS = ['RTX 4090','RTX 4080','RTX 4070 Ti','RTX 4070','RX 7900 XTX','RX 7900 XT'];
const RAM_MODELS = ['DDR5 32GB 6000MHz','DDR5 16GB 6000MHz','DDR4 32GB 3200MHz','DDR4 16GB 3200MHz'];

// â”€â”€â”€ Clock â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('fr-FR');
}
setInterval(updateClock, 1000);
updateClock();

// â”€â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(tab) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`section-${tab}`).classList.add('active');
  document.getElementById(`tab-${tab}`).classList.add('active');
  if (tab === 'tech') loadTechData();
}

// â”€â”€â”€ Fetch wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function apiFetch(url) {
  const r = await fetch(API + url);
  return r.json();
}

// â”€â”€â”€ Chart factory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createTradingChart(ctx, data, color = '#00d4a4') {
  const prices = data.map(d => d.price);
  const labels = data.map(d => {
    const dt = new Date(d.time);
    return dt.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
  });

  const isUp = prices[prices.length-1] >= prices[0];
  const lineColor = isUp ? '#00d4a4' : '#ff4b6e';
  const fillColor = isUp ? 'rgba(0,212,164,0.08)' : 'rgba(255,75,110,0.08)';

  return new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        data: prices,
        borderColor: lineColor,
        borderWidth: 2,
        fill: true,
        backgroundColor: (context) => {
          const gradient = context.chart.ctx.createLinearGradient(0, 0, 0, context.chart.height);
          gradient.addColorStop(0, isUp ? 'rgba(0,212,164,0.2)' : 'rgba(255,75,110,0.2)');
          gradient.addColorStop(1, 'rgba(0,0,0,0)');
          return gradient;
        },
        tension: 0.3,
        pointRadius: 0,
        pointHoverRadius: 4,
        pointHoverBackgroundColor: lineColor,
        pointHoverBorderColor: '#fff',
        pointHoverBorderWidth: 2,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 300 },
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#141920',
          borderColor: '#1e2d3d',
          borderWidth: 1,
          titleColor: '#7a9ab5',
          bodyColor: '#c8d8e8',
          titleFont: { family: 'JetBrains Mono', size: 11 },
          bodyFont: { family: 'JetBrains Mono', size: 13, weight: 'bold' },
          callbacks: {
            label: (ctx) => ` ${ctx.raw.toFixed(2)} â‚¬`
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(30,45,61,0.5)', drawBorder: false },
          ticks: {
            color: '#4a6a85',
            font: { family: 'JetBrains Mono', size: 10 },
            maxTicksLimit: 8,
            maxRotation: 0,
          },
          border: { display: false }
        },
        y: {
          position: 'right',
          grid: { color: 'rgba(30,45,61,0.5)', drawBorder: false },
          ticks: {
            color: '#4a6a85',
            font: { family: 'JetBrains Mono', size: 10 },
            callback: (v) => `${v.toFixed(0)}â‚¬`,
            maxTicksLimit: 6,
          },
          border: { display: false }
        }
      }
    }
  });
}

function createSparkline(ctx, prices, isUp) {
  const color = isUp ? '#00d4a4' : '#ff4b6e';
  return new Chart(ctx, {
    type: 'line',
    data: {
      labels: prices.map((_, i) => i),
      datasets: [{ data: prices, borderColor: color, borderWidth: 1.5,
        fill: false, tension: 0.3, pointRadius: 0 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      animation: false,
      plugins: { legend: { display: false }, tooltip: { enabled: false } },
      scales: {
        x: { display: false },
        y: { display: false }
      }
    }
  });
}

// â”€â”€â”€ Initialize Routes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initRoutes() {
  const routes = await apiFetch('/api/routes');
  allRoutes = routes;

  // Populate selects
  const cities = [...new Set(routes.flatMap(r => [r.from, r.to]))].sort();
  const fromSelect = document.getElementById('select-from');
  const toSelect = document.getElementById('select-to');

  cities.forEach(city => {
    const opt = new Option(city, city);
    fromSelect.add(opt);
  });

  // Set default date (tomorrow)
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  document.getElementById('travel-date').value = tomorrow.toISOString().split('T')[0];

  // Load initial data
  await loadAllRoutePrices();
  buildTicker();
  buildWatchlist();
  buildRouteGrid();

  // Auto-select first route
  if (allRoutes.length > 0) {
    loadRouteChart(allRoutes[0].id);
  }
}

function updateToOptions() {
  const from = document.getElementById('select-from').value;
  const toSelect = document.getElementById('select-to');
  toSelect.innerHTML = '<option value="">Choisir...</option>';
  if (!from) return;
  
  allRoutes
    .filter(r => r.from === from || r.to === from)
    .forEach(r => {
      const dest = r.from === from ? r.to : r.from;
      const routeId = r.from === from ? r.id : `${r.to}-${r.from}`;
      toSelect.add(new Option(dest, r.id));
    });
}

function searchTrain() {
  const routeId = document.getElementById('select-to').value;
  if (!routeId) { alert('SÃ©lectionnez une destination'); return; }
  loadRouteChart(routeId);
}

// â”€â”€â”€ Store route data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const routeDataCache = {};

async function loadAllRoutePrices() {
  for (const route of allRoutes) {
    const data = await apiFetch(`/api/train/${route.id}`);
    routeDataCache[route.id] = data;
  }
}

// â”€â”€â”€ Ticker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTicker() {
  const items = Object.entries(routeDataCache).map(([id, d]) => {
    const isUp = d.change >= 0;
    const arrow = isUp ? 'â–²' : 'â–¼';
    const cls = isUp ? 'up' : 'down';
    return `<span class="ticker-item">
      <span class="ticker-route">${id.replace('-', ' â†’ ')}</span>
      <span class="ticker-price">${d.current.toFixed(2)}â‚¬</span>
      <span class="ticker-change ${cls}">${arrow} ${Math.abs(d.change).toFixed(2)}â‚¬</span>
    </span>`;
  }).join('');
  
  // Duplicate for seamless loop
  document.getElementById('ticker-track').innerHTML = items + items;
}

// â”€â”€â”€ Watchlist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WATCHLIST = ['PARIS-LYON', 'PARIS-MARSEILLE', 'PARIS-BORDEAUX', 'PARIS-NICE', 'PARIS-LILLE'];

function buildWatchlist() {
  const container = document.getElementById('watchlist-items');
  container.innerHTML = WATCHLIST.map(routeId => {
    const d = routeDataCache[routeId];
    if (!d) return '';
    const isUp = d.change >= 0;
    return `<div class="wl-item" onclick="loadRouteChart('${routeId}')">
      <div class="wl-item-route">${routeId.replace('-', ' â†’ ')}</div>
      <div class="wl-item-price" id="wl-price-${routeId}">${d.current.toFixed(2)}â‚¬</div>
      <div class="wl-item-change ${isUp ? 'up' : 'down'}" id="wl-change-${routeId}">
        ${isUp ? 'â–²' : 'â–¼'} ${Math.abs(d.changePercent)}%
      </div>
    </div>`;
  }).join('');
}

// â”€â”€â”€ Route Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildRouteGrid() {
  const grid = document.getElementById('route-grid');
  grid.innerHTML = '';

  allRoutes.forEach(route => {
    const d = routeDataCache[route.id];
    if (!d) return;

    const isUp = d.change >= 0;
    const card = document.createElement('div');
    card.className = 'route-card';
    card.id = `card-${route.id}`;
    card.innerHTML = `
      <div class="route-card-header">
        <div class="route-name">
          ${route.from} <span class="route-arrow">â†’</span> ${route.to}
        </div>
        <div class="route-price" id="card-price-${route.id}">${d.current.toFixed(2)}â‚¬</div>
      </div>
      <canvas class="route-sparkline" id="spark-${route.id}" height="36"></canvas>
      <div class="route-meta">
        <span class="route-badge ${isUp ? 'up' : 'down'}" id="card-badge-${route.id}">
          ${isUp ? 'â–²' : 'â–¼'} ${Math.abs(d.changePercent)}%
        </span>
        <span class="route-vol">H: ${d.high.toFixed(0)}â‚¬ B: ${d.low.toFixed(0)}â‚¬</span>
      </div>
    `;
    card.onclick = () => loadRouteChart(route.id);
    grid.appendChild(card);

    // Draw sparkline
    setTimeout(() => {
      const sparkCanvas = document.getElementById(`spark-${route.id}`);
      if (sparkCanvas) {
        if (sparklineCharts[route.id]) sparklineCharts[route.id].destroy();
        const prices = d.history.slice(-20).map(h => h.price);
        sparklineCharts[route.id] = createSparkline(sparkCanvas.getContext('2d'), prices, isUp);
      }
    }, 50);
  });
}

// â”€â”€â”€ Load Main Route Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadRouteChart(routeId) {
  selectedRoute = routeId;
  
  // Highlight active card
  document.querySelectorAll('.route-card').forEach(c => c.classList.remove('active-card'));
  const activeCard = document.getElementById(`card-${routeId}`);
  if (activeCard) activeCard.classList.add('active-card');

  const data = await apiFetch(`/api/train/${routeId}`);
  routeDataCache[routeId] = data;

  const [from, to] = routeId.split('-');
  document.getElementById('main-chart-title').textContent = `${from} â†’ ${to}`;
  document.getElementById('main-chart-subtitle').textContent =
    `${data.history.length} points â€” mis Ã  jour en temps rÃ©el`;

  // Update price display
  const isUp = data.change >= 0;
  document.getElementById('main-price-display').style.display = 'block';
  document.getElementById('main-current-price').textContent = `${data.current.toFixed(2)}â‚¬`;
  document.getElementById('main-current-price').className = `current-price ${isUp ? 'up' : 'down'}`;
  document.getElementById('main-price-change').innerHTML =
    `<span class="${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(data.change).toFixed(2)}â‚¬ (${isUp ? '+' : ''}${data.changePercent}%)</span>`;

  // Stats
  document.getElementById('stat-open').textContent = `${data.open.toFixed(2)}â‚¬`;
  document.getElementById('stat-high').textContent = `${data.high.toFixed(2)}â‚¬`;
  document.getElementById('stat-low').textContent = `${data.low.toFixed(2)}â‚¬`;
  document.getElementById('stat-current').textContent = `${data.current.toFixed(2)}â‚¬`;
  document.getElementById('stat-change').innerHTML =
    `<span class="${isUp ? 'up' : 'down'}">${isUp ? '+' : ''}${data.change.toFixed(2)}â‚¬</span>`;
  document.getElementById('stat-changepct').innerHTML =
    `<span class="${isUp ? 'up' : 'down'}">${isUp ? '+' : ''}${data.changePercent}%</span>`;

  // Order book
  buildOrderBook(data.current);

  // Chart
  const canvas = document.getElementById('mainChart');
  canvas.style.display = 'block';
  document.getElementById('chart-empty').style.display = 'none';

  if (mainChart) { mainChart.destroy(); mainChart = null; }
  mainChart = createTradingChart(canvas.getContext('2d'), data.history);
}

function buildOrderBook(currentPrice) {
  const levels = 5;
  let html = '';
  for (let i = levels; i >= 1; i--) {
    const ask = currentPrice + i * (Math.random() * 2 + 0.5);
    const qty = Math.floor(Math.random() * 8 + 1);
    html += `<div class="order-book-row">
      <span class="ask">${ask.toFixed(2)}â‚¬</span>
      <span class="mid">${qty} billet${qty>1?'s':''}</span>
      <span></span>
    </div>`;
  }
  // Spread
  html += `<div class="order-book-row" style="background:rgba(77,159,255,0.05); border-color:rgba(77,159,255,0.2)">
    <span style="color:var(--blue); font-weight:700; font-family:'JetBrains Mono',monospace; font-size:13px;">${currentPrice.toFixed(2)}â‚¬</span>
    <span class="mid" style="color:var(--blue)">actuel</span>
    <span></span>
  </div>`;
  for (let i = 1; i <= levels; i++) {
    const bid = currentPrice - i * (Math.random() * 2 + 0.5);
    if (bid < 0) continue;
    const qty = Math.floor(Math.random() * 8 + 1);
    html += `<div class="order-book-row">
      <span></span>
      <span class="mid">${qty} billet${qty>1?'s':''}</span>
      <span class="bid">${bid.toFixed(2)}â‚¬</span>
    </div>`;
  }
  document.getElementById('order-book').innerHTML = html;
}

// â”€â”€â”€ Tech Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadTechData() {
  const data = await apiFetch('/api/tech');
  techData = data;
  buildTechTables();
  if (selectedTech) updateTechChart(selectedTech);
}

function buildTechTables() {
  buildTechTable('gpu-tbody', GPU_MODELS);
  buildTechTable('ram-tbody', RAM_MODELS);
}

function buildTechTable(tbodyId, models) {
  const tbody = document.getElementById(tbodyId);
  tbody.innerHTML = '';

  models.forEach(model => {
    const d = techData[model];
    if (!d) return;
    const isUp = d.change >= 0;
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="td-name">${model}</td>
      <td class="td-price" id="tech-price-${model.replace(/\s+/g,'-')}">${d.current.toFixed(2)}â‚¬</td>
      <td class="td-change ${isUp ? 'up' : 'down'}" id="tech-change-${model.replace(/\s+/g,'-')}">
        ${isUp ? 'â–²' : 'â–¼'} ${Math.abs(d.changePercent)}%
      </td>
      <td class="td-sparkline">
        <canvas id="tech-spark-${model.replace(/\s+/g,'-')}" height="30"></canvas>
      </td>
    `;
    row.onclick = () => loadTechChart(model);
    tbody.appendChild(row);

    setTimeout(() => {
      const sparkCanvas = document.getElementById(`tech-spark-${model.replace(/\s+/g,'-')}`);
      if (sparkCanvas) {
        const prices = d.history.slice(-20).map(h => h.price);
        createSparkline(sparkCanvas.getContext('2d'), prices, isUp);
      }
    }, 50);
  });
}

async function loadTechChart(product) {
  selectedTech = product;
  const data = await apiFetch(`/api/tech/${encodeURIComponent(product)}`);

  document.getElementById('tech-chart-title').textContent = product;
  document.getElementById('tech-chart-subtitle').textContent = 
    `${data.history.length} points â€” mis Ã  jour en temps rÃ©el`;

  const isUp = data.change >= 0;
  document.getElementById('tech-price-display').style.display = 'block';
  document.getElementById('tech-current-price').textContent = `${data.current.toFixed(2)}â‚¬`;
  document.getElementById('tech-current-price').className = `current-price ${isUp ? 'up' : 'down'}`;
  document.getElementById('tech-price-change').innerHTML =
    `<span class="${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(data.change).toFixed(2)}â‚¬ (${isUp ? '+' : ''}${data.changePercent}%)</span>`;

  const canvas = document.getElementById('techChart');
  canvas.style.display = 'block';
  document.getElementById('tech-chart-empty').style.display = 'none';

  if (techChart) { techChart.destroy(); techChart = null; }
  techChart = createTradingChart(canvas.getContext('2d'), data.history);
}

async function updateTechChart(product) {
  if (!techChart) return;
  const data = await apiFetch(`/api/tech/${encodeURIComponent(product)}`);
  const prices = data.history.map(d => d.price);
  const labels = data.history.map(d => {
    const dt = new Date(d.time);
    return dt.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
  });
  techChart.data.labels = labels;
  techChart.data.datasets[0].data = prices;
  techChart.update('none');
}

// â”€â”€â”€ Live Updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function liveUpdate() {
  // Update train prices
  for (const route of allRoutes) {
    const data = await apiFetch(`/api/train/${route.id}`);
    const prev = routeDataCache[route.id];
    const changed = prev && data.current !== prev.current;
    routeDataCache[route.id] = data;

    // Update card
    const priceEl = document.getElementById(`card-price-${route.id}`);
    if (priceEl) {
      const isUp = data.change >= 0;
      priceEl.textContent = `${data.current.toFixed(2)}â‚¬`;
      priceEl.className = `route-price ${isUp ? 'up' : 'down'}`;
      if (changed) {
        const card = document.getElementById(`card-${route.id}`);
        if (card) {
          card.classList.add(isUp ? 'flash-up' : 'flash-down');
          setTimeout(() => card.classList.remove('flash-up', 'flash-down'), 500);
        }
      }
    }

    const badgeEl = document.getElementById(`card-badge-${route.id}`);
    if (badgeEl) {
      const isUp = data.change >= 0;
      badgeEl.className = `route-badge ${isUp ? 'up' : 'down'}`;
      badgeEl.textContent = `${isUp ? 'â–²' : 'â–¼'} ${Math.abs(data.changePercent)}%`;
    }

    // Update watchlist
    const wlPrice = document.getElementById(`wl-price-${route.id}`);
    const wlChange = document.getElementById(`wl-change-${route.id}`);
    if (wlPrice) {
      const isUp = data.change >= 0;
      wlPrice.textContent = `${data.current.toFixed(2)}â‚¬`;
      wlChange.className = `wl-item-change ${isUp ? 'up' : 'down'}`;
      wlChange.textContent = `${isUp ? 'â–²' : 'â–¼'} ${Math.abs(data.changePercent)}%`;
    }
  }

  // Update main chart if selected
  if (selectedRoute && mainChart) {
    const data = routeDataCache[selectedRoute];
    if (data) {
      const prices = data.history.map(d => d.price);
      const labels = data.history.map(d => {
        const dt = new Date(d.time);
        return dt.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
      });
      mainChart.data.labels = labels;
      mainChart.data.datasets[0].data = prices;
      const isUp = data.change >= 0;
      mainChart.data.datasets[0].borderColor = isUp ? '#00d4a4' : '#ff4b6e';
      mainChart.update('none');

      // Update header
      document.getElementById('main-current-price').textContent = `${data.current.toFixed(2)}â‚¬`;
      document.getElementById('main-current-price').className = `current-price ${isUp ? 'up' : 'down'}`;
      document.getElementById('main-price-change').innerHTML =
        `<span class="${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(data.change).toFixed(2)}â‚¬ (${isUp ? '+' : ''}${data.changePercent}%)</span>`;

      document.getElementById('stat-current').textContent = `${data.current.toFixed(2)}â‚¬`;
      document.getElementById('stat-high').textContent = `${data.high.toFixed(2)}â‚¬`;
      document.getElementById('stat-low').textContent = `${data.low.toFixed(2)}â‚¬`;
    }
  }

  // Rebuild ticker
  buildTicker();
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
  await initRoutes();
  // Update every 30 seconds
  setInterval(liveUpdate, 30000);
  // Update tech if on tech tab
  setInterval(() => {
    if (document.getElementById('section-tech').classList.contains('active')) {
      loadTechData();
    }
  }, 30000);
}

init().catch(console.error);
</script>
</body>
</html>
